

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>baxter_helper</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="" href="../index.html" />
    <link rel="up" title="Module code" href="index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">baxter_tasker documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for baxter_helper</h1><div class="highlight"><pre>
<span class="c">#!/usr/bin/env python</span>


<span class="c">########################################################################### </span>
<span class="c"># This software is graciously provided by HumaRobotics </span>
<span class="c"># under the Simplified BSD License on</span>
<span class="c"># github: git@www.humarobotics.com:baxter_tasker</span>
<span class="c"># HumaRobotics is a trademark of Generation Robots.</span>
<span class="c"># www.humarobotics.com </span>

<span class="c"># Copyright (c) 2013, Generation Robots.</span>
<span class="c"># All rights reserved.</span>
<span class="c"># www.generationrobots.com</span>
<span class="c">#   </span>
<span class="c"># Redistribution and use in source and binary forms, with or without </span>
<span class="c"># modification, are permitted provided that the following conditions are met:</span>
<span class="c"># </span>
<span class="c"># 1. Redistributions of source code must retain the above copyright notice,</span>
<span class="c">#  this list of conditions and the following disclaimer.</span>
<span class="c"># </span>
<span class="c"># 2. Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="c">#  this list of conditions and the following disclaimer in the documentation </span>
<span class="c">#  and/or other materials provided with the distribution.</span>
<span class="c"># </span>
<span class="c"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="c"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, </span>
<span class="c"># THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR </span>
<span class="c"># PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS </span>
<span class="c"># BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR </span>
<span class="c"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF </span>
<span class="c"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS </span>
<span class="c"># INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN </span>
<span class="c"># CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) </span>
<span class="c"># ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF </span>
<span class="c"># THE POSSIBILITY OF SUCH DAMAGE. </span>
<span class="c"># </span>
<span class="c"># The views and conclusions contained in the software and documentation are </span>
<span class="c"># those of the authors and should not be interpreted as representing official </span>
<span class="c"># policies, either expressed or implied, of the FreeBSD Project.</span>
<span class="c">#</span>
<span class="c">#############################################################################</span>
<span class="c"># Copyright (c) 2013, Rethink Robotics</span>
<span class="c"># All rights reserved.</span>
<span class="c">#</span>
<span class="c"># Redistribution and use in source and binary forms, with or without</span>
<span class="c"># modification, are permitted provided that the following conditions are met:</span>
<span class="c">#</span>
<span class="c"># 1. Redistributions of source code must retain the above copyright notice,</span>
<span class="c">#    this list of conditions and the following disclaimer.</span>
<span class="c"># 2. Redistributions in binary form must reproduce the above copyright</span>
<span class="c">#    notice, this list of conditions and the following disclaimer in the</span>
<span class="c">#    documentation and/or other materials provided with the distribution.</span>
<span class="c"># 3. Neither the name of the Rethink Robotics nor the names of its</span>
<span class="c">#    contributors may be used to endorse or promote products derived from</span>
<span class="c">#    this software without specific prior written permission.</span>
<span class="c">#</span>
<span class="c"># THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot;</span>
<span class="c"># AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="c"># IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE</span>
<span class="c"># ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE</span>
<span class="c"># LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR</span>
<span class="c"># CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF</span>
<span class="c"># SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS</span>
<span class="c"># INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN</span>
<span class="c"># CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)</span>
<span class="c"># ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE</span>
<span class="c"># POSSIBILITY OF SUCH DAMAGE.</span>
<span class="c">##############################################################################</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">rospy</span>

<span class="kn">from</span> <span class="nn">baxter_helper_frame</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">hr_helper.post_threading</span> <span class="kn">import</span> <span class="n">Post</span>
<span class="kn">from</span> <span class="nn">threading</span> <span class="kn">import</span> <span class="n">Lock</span><span class="p">,</span><span class="n">Thread</span>

<span class="kn">from</span> <span class="nn">std_msgs.msg</span> <span class="kn">import</span> <span class="n">Empty</span><span class="p">,</span> <span class="n">UInt16</span>
<span class="kn">from</span> <span class="nn">sensor_msgs.msg</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span><span class="n">Range</span>
<span class="kn">import</span> <span class="nn">gripper</span>

<span class="kn">from</span> <span class="nn">baxter_core_msgs.srv</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">ListCameras</span><span class="p">,</span>
    <span class="p">)</span>
<span class="kn">from</span> <span class="nn">baxter_core_msgs.msg</span> <span class="kn">import</span> <span class="p">(</span>    
    <span class="n">EndEffectorProperties</span><span class="p">,</span>
    <span class="n">AssemblyState</span><span class="p">,</span>
    <span class="p">)</span>
<span class="kn">import</span> <span class="nn">baxter_interface</span>
<span class="kn">from</span> <span class="nn">baxter_image_text_displayer</span> <span class="kn">import</span> <span class="n">ImageTextDisplayer</span>
<span class="kn">import</span> <span class="nn">cv</span>
<span class="kn">import</span> <span class="nn">cv_bridge</span>

<span class="kn">from</span> <span class="nn">baxter_behaviors</span> <span class="kn">import</span> <span class="n">BaxterBehaviors</span>

<span class="kn">from</span> <span class="nn">baxter_scene</span> <span class="kn">import</span> <span class="n">BaxterScene</span> 
<span class="kn">from</span> <span class="nn">baxter_helper_menu</span> <span class="kn">import</span> <span class="p">(</span>
                         <span class="n">BaxterMenuEntries</span><span class="p">,</span>
                         <span class="n">BaxterMenuComposer</span><span class="p">,</span>
                         <span class="n">BaxterMenuManager</span><span class="p">,</span>
                         <span class="p">)</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getmembers</span>
<span class="n">DEFAULT_RATE</span><span class="o">=</span><span class="mi">200</span>
<span class="kn">from</span> <span class="nn">high_level_movement</span> <span class="kn">import</span> <span class="n">HighLevelMovement</span>
<span class="kn">from</span> <span class="nn">baxter_urdf_creator</span> <span class="kn">import</span> <span class="n">BaxterURDFCreator</span>
<span class="kn">from</span> <span class="nn">hr_helper.singleton</span> <span class="kn">import</span> <span class="n">Singleton</span>

<div class="viewcode-block" id="BaxterException"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterException">[docs]</a><span class="k">class</span> <span class="nc">BaxterException</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>

   </div>
<div class="viewcode-block" id="BaxterRecorder"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRecorder">[docs]</a><span class="k">class</span> <span class="nc">BaxterRecorder</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Records and plays manually learned trajectories. While two trajectories can be played simultaneously,</span>
<span class="sd">        the recording has to take place consecutively</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">baxter</span><span class="p">,</span><span class="n">filename</span> <span class="o">=</span> <span class="s">&quot;current_recording_&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Records joint data to a file at a specified rate.</span>
<span class="sd">        </span>
<span class="sd">        :param filename: defines the base name for a recording</span>
<span class="sd">        :type filename: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span> <span class="o">=</span> <span class="n">baxter</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">datapath</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stop_execution</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;left&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s">&quot;right&quot;</span><span class="p">:</span><span class="bp">False</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mutex</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;left&quot;</span><span class="p">:</span><span class="n">Lock</span><span class="p">(),</span><span class="s">&quot;right&quot;</span><span class="p">:</span><span class="n">Lock</span><span class="p">()}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_raw_rate</span> <span class="o">=</span> <span class="n">DEFAULT_RATE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="n">DEFAULT_RATE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_start_time</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="bp">False</span>
        

    <span class="c">###### RECORD ###########</span>
    
<div class="viewcode-block" id="BaxterRecorder.record"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRecorder.record">[docs]</a>    <span class="k">def</span> <span class="nf">record</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">,</span><span class="n">number</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Records the current joint positions of the given side </span>
<span class="sd">            to a csv file if the cuff button is pressed </span>
<span class="sd">    </span>
<span class="sd">            This function will overwrite</span>
<span class="sd">            existing files.</span>
<span class="sd">            </span>
<span class="sd">            :param side: side to be recorded</span>
<span class="sd">            :type side: str</span>
<span class="sd">            :param number: added to the filename, if previous file should not be overwritten</span>
<span class="sd">            :type number: int  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutex</span><span class="p">[</span><span class="n">side</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
            <span class="n">timestamp</span> <span class="o">=</span> <span class="mf">0.0</span>
            <span class="nb">file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+</span> <span class="n">side</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__recordState</span><span class="p">(</span><span class="n">side</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">joint_names</span><span class="p">()</span>
            <span class="n">cuff_btn</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">dio</span><span class="p">[</span><span class="n">side</span><span class="o">+</span><span class="s">&quot;_lower_cuff&quot;</span><span class="p">]</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="s">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;time,&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">joints</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
                <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">side</span><span class="o">+</span><span class="s">&#39;_gripper</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">__recordState</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">mm</span><span class="o">.</span><span class="n">cur_page</span> <span class="o">==</span> <span class="s">&quot;teach&quot;</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">cuff_btn</span><span class="o">.</span><span class="n">state</span><span class="p">:</span> <span class="c"># only record if cuff is pressed</span>
                        <span class="n">angles</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">joint_angle</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">joints</span><span class="p">]</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%f</span><span class="s">,&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">timestamp</span><span class="p">))</span>
                        <span class="n">timestamp</span> <span class="o">+=</span><span class="p">(</span><span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">_raw_rate</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">angles</span><span class="p">])</span> <span class="o">+</span> <span class="s">&#39;,&#39;</span><span class="p">)</span>
                        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">gripper</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">position</span><span class="p">())</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;stopped recording&quot;</span><span class="p">)</span>

</div>
    <span class="k">def</span> <span class="nf">__recordState</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">,</span> <span class="n">state</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Changes or gets recording state</span>
<span class="sd">        </span>
<span class="sd">        :param side: side of the state that should be modified</span>
<span class="sd">        :type side: str</span>
<span class="sd">        :param state:</span>
<span class="sd">        :type state: bool</span>
<span class="sd">        :return: State of the recording</span>
<span class="sd">        :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
            <span class="n">state</span> <span class="o">=</span> <span class="bp">True</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">state</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span>
            

<div class="viewcode-block" id="BaxterRecorder.stopRecording"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRecorder.stopRecording">[docs]</a>    <span class="k">def</span> <span class="nf">stopRecording</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Stops a recording</span>
<span class="sd">            </span>
<span class="sd">            :param side: The side that should be recorded</span>
<span class="sd">            :type side: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__recordState</span><span class="p">(</span><span class="n">side</span><span class="p">,</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span> <span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">e</span><span class="p">)</span>
        
    <span class="c">##### PLAYBACK ############</span>
</div>
<div class="viewcode-block" id="BaxterRecorder.try_float"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRecorder.try_float">[docs]</a>    <span class="k">def</span> <span class="nf">try_float</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Converts something to float</span>
<span class="sd">            </span>
<span class="sd">            :param x: data to be converted</span>
<span class="sd">            :type x: any</span>
<span class="sd">            :return: data converted to float or None</span>
<span class="sd">            :rtype: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="BaxterRecorder.stopExecution"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRecorder.stopExecution">[docs]</a>    <span class="k">def</span> <span class="nf">stopExecution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">,</span><span class="n">stop</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Sets an execution or gets the current execution state of the &quot;stop&quot; param is None</span>
<span class="sd">            </span>
<span class="sd">            :param side: side of execution to be modified</span>
<span class="sd">            :type side: str</span>
<span class="sd">            :param stop: Defines if current executions are stop and if future trajectories are executed.</span>
<span class="sd">            :type stop: bool</span>
<span class="sd">            :return: State of execution</span>
<span class="sd">            :rtype: bool</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stop</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">stop_execution</span><span class="p">[</span><span class="n">side</span><span class="p">]</span> <span class="o">=</span> <span class="n">stop</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">stop_execution</span><span class="p">[</span><span class="n">side</span><span class="p">]</span>
        </div>
<div class="viewcode-block" id="BaxterRecorder.clean_line"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRecorder.clean_line">[docs]</a>    <span class="k">def</span> <span class="nf">clean_line</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">line</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span><span class="n">side</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Cleans a single line of recorded joint positions</span>

<span class="sd">        :param line: the line described in a list to process</span>
<span class="sd">        :param names: joint name keys</span>
<span class="sd">        :param side: the arm side</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#convert the line of strings to a float or None</span>
        <span class="n">line</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">try_float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)]</span>
        <span class="c">#zip the values with the joint names</span>
        <span class="n">combined</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">line</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
        <span class="c">#take out any tuples that have a none value</span>
        <span class="n">cleaned</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">combined</span> <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">]</span>
        <span class="c">#convert it to a dictionary with only valid commands</span>
        <span class="n">command</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">cleaned</span><span class="p">)</span>
        <span class="n">side_command</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">((</span><span class="n">key</span><span class="p">,</span> <span class="n">command</span><span class="p">[</span><span class="n">key</span><span class="p">])</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">command</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
                            <span class="k">if</span> <span class="n">key</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">side</span><span class="o">+</span><span class="s">&#39;_&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">side_command</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="BaxterRecorder.play"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRecorder.play">[docs]</a>    <span class="k">def</span> <span class="nf">play</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">,</span> <span class="n">loops</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">number</span><span class="o">=</span><span class="s">&quot;&quot;</span><span class="p">):</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">mutex</span><span class="p">[</span><span class="n">side</span><span class="p">]:</span>
            
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loops through csv file</span>
<span class="sd">    </span>
<span class="sd">            :param filename: the file to play</span>
<span class="sd">            :type filename: str</span>
<span class="sd">            :param loops: number of times to loop; values &lt; 0 mean &#39;infinite&#39;</span>
<span class="sd">            :type loops: int</span>
<span class="sd">    </span>
<span class="sd">            Does not loop indefinitely, but only until the file is read</span>
<span class="sd">            and processed. Reads each line, split up in columns and</span>
<span class="sd">            formats each line into a controller command in the form of</span>
<span class="sd">            name/value pairs. Names come from the column headers</span>
<span class="sd">            first column is the time stamp</span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="n">rate</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="n">DEFAULT_RATE</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_joint_position_speed</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Playing back: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="n">side</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">),))</span>
            <span class="kn">import</span> <span class="nn">os</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="n">side</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">)):</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="s">&quot;File to play back does not exist&quot;</span><span class="p">)</span>
                <span class="k">return</span> 
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="n">side</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">number</span><span class="p">),</span> <span class="s">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
            <span class="n">keys</span> <span class="o">=</span> <span class="n">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;,&#39;</span><span class="p">)</span>
            <span class="n">already_error</span> <span class="o">=</span> <span class="bp">False</span>
            <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c"># If specified, repeat the file playback &#39;loops&#39; number of times</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">lines</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Current recording is empty. Have you recorded a trajectory?&quot;</span><span class="p">)</span>
<span class="c">#                     self.baxter.hlm.stop(True)</span>
                    <span class="k">return</span> <span class="bp">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">mm</span><span class="o">.</span><span class="n">addEntriesToCurrentMenu</span><span class="p">({</span><span class="s">&quot;Stop &quot;</span><span class="o">+</span><span class="n">side</span><span class="o">+</span><span class="s">&quot; Arm&quot;</span><span class="p">:</span><span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">bb</span><span class="o">.</span><span class="n">stopTeachedPath</span><span class="p">})</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">loops</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="ow">or</span> <span class="n">l</span> <span class="o">&lt;</span> <span class="n">loops</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopExecution</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="n">l</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Moving to start position...&quot;</span><span class="p">)</span>
                    <span class="n">_cmd</span><span class="p">,</span> <span class="n">cmd_start</span><span class="p">,</span> <span class="n">_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_line</span><span class="p">(</span><span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">keys</span><span class="p">,</span><span class="n">side</span><span class="p">)</span>
                    
                    <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">move_to_joint_positions</span><span class="p">(</span><span class="n">cmd_start</span><span class="p">)</span>
                    <span class="n">start_time</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
                    <span class="k">for</span> <span class="n">values</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
                        <span class="n">loopstr</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">loops</span><span class="p">)</span> <span class="k">if</span> <span class="n">loops</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="s">&quot;forever&quot;</span>
                        <span class="n">cmd</span><span class="p">,</span> <span class="n">scmd</span><span class="p">,</span> <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clean_line</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">keys</span><span class="p">,</span><span class="n">side</span><span class="p">)</span>
                        <span class="k">while</span> <span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">stopExecution</span><span class="p">(</span><span class="n">side</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                            
                            <span class="k">if</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
                                <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s"> Aborting - ROS shutdown&quot;</span><span class="p">)</span>
                                <span class="k">return</span> <span class="bp">False</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">scmd</span><span class="p">):</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">set_joint_positions</span><span class="p">(</span><span class="n">scmd</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">side</span><span class="o">+</span><span class="s">&#39;_gripper&#39;</span> <span class="ow">in</span> <span class="n">cmd</span><span class="p">:</span>
                                <span class="k">if</span> <span class="n">already_error</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">gripper</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">command_position</span><span class="p">(</span><span class="n">cmd</span><span class="p">[</span><span class="n">side</span><span class="o">+</span><span class="s">&#39;_gripper&#39;</span><span class="p">])</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
                                        <span class="n">already_error</span> <span class="o">=</span> <span class="bp">True</span>
                                    
                            <span class="n">rate</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
                    <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Done executing saved path&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;There was a problem in the motion of the </span><span class="si">%s</span><span class="s"> arm. </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">side</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">hlm</span><span class="o">.</span><span class="n">stop</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">False</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">baxter</span><span class="o">.</span><span class="n">mm</span><span class="o">.</span><span class="n">removeEntriesFromCurrentMenu</span><span class="p">([</span><span class="s">&quot;Stop &quot;</span><span class="o">+</span><span class="n">side</span><span class="o">+</span><span class="s">&quot; Arm&quot;</span><span class="p">])</span>
            <span class="k">return</span> <span class="bp">True</span>
</div></div>
<div class="viewcode-block" id="Gripper"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Gripper">[docs]</a><span class="k">class</span> <span class="nc">Gripper</span><span class="p">(</span><span class="n">gripper</span><span class="o">.</span><span class="n">Gripper</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">        Extends baxter gripper interface with:</span>
<span class="sd">        grip and release  commands, </span>
<span class="sd">        replaces open/close</span>
<span class="sd">        set a specific position,</span>
<span class="sd">        custom calibration,</span>
<span class="sd">        check if object has been gripped </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">,</span><span class="n">scene</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :param side: The side for which the gripper object should be created</span>
<span class="sd">            :type side: str</span>
<span class="sd">            :param scene: If MoveIt is used the scene has to be passed here</span>
<span class="sd">            :type: moveit_commander.PlanningSceneInterface()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">side</span> <span class="ow">in</span> <span class="p">[</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="s">&quot;right&quot;</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="n">BaxterException</span><span class="p">,</span><span class="s">&quot;Error non existing side: </span><span class="si">%s</span><span class="s">, please provide left or right&quot;</span><span class="o">%</span><span class="n">side</span>        
        <span class="n">gripper</span><span class="o">.</span><span class="n">Gripper</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">side</span><span class="o">=</span><span class="n">side</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">=</span><span class="n">Post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_position</span> <span class="o">=</span> <span class="mi">100</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_position</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">outside_grip</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">scene</span>
<span class="c">#         self.parameters()[&#39;moving_force&#39;]</span>
        
        
<div class="viewcode-block" id="Gripper.open"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Gripper.open">[docs]</a>    <span class="k">def</span> <span class="nf">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">block</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">8.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Opens the gripper</span>
<span class="sd">            </span>
<span class="sd">            :param block: If True waits until the gripper finished its movement</span>
<span class="sd">            :type block: bool</span>
<span class="sd">            :param timeout: Time to try to execute the command (for pneumatic gripper it affects the time to stop the airflow if nothing is grasped)</span>
<span class="sd">            :type timeout: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c">#         print &quot;opening gripper&quot;</span>
        <span class="c">#~ print &quot;moving force&quot;,self.parameters()[&#39;moving_force&#39;]</span>
        <span class="n">gripper</span><span class="o">.</span><span class="n">Gripper</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">block</span><span class="p">,</span><span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">attachGripper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">(),</span><span class="bp">True</span><span class="p">)</span>
            
            
        </div>
<div class="viewcode-block" id="Gripper.close"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Gripper.close">[docs]</a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">block</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mf">8.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Closes the gripper</span>
<span class="sd">            </span>
<span class="sd">            :param block: If True waits until the gripper finished its movement</span>
<span class="sd">            :type block: bool</span>
<span class="sd">            :param timeout: Time to try to execute the command (for pneumatic gripper it affects the time to stop the airflow if nothing is grasped)</span>
<span class="sd">            :type timeout: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c">#         print &quot;closing gripper&quot;</span>
        <span class="c">#~ print &quot;moving force&quot;,self.parameters()[&#39;moving_force&#39;]</span>
        <span class="n">gripper</span><span class="o">.</span><span class="n">Gripper</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">block</span><span class="p">,</span><span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">opened</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">attachGripper</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">(),</span><span class="bp">False</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Gripper.setPosition"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Gripper.setPosition">[docs]</a>    <span class="k">def</span> <span class="nf">setPosition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">position</span><span class="p">,</span><span class="n">blocking</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">command_position</span><span class="p">(</span><span class="n">position</span><span class="p">,</span><span class="n">blocking</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Gripper.calibrateAdvanced"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Gripper.calibrateAdvanced">[docs]</a>    <span class="k">def</span> <span class="nf">calibrateAdvanced</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets the farmost open and close position </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">logdebug</span><span class="p">(</span><span class="s">&quot;Calibrate Advanced Open: </span><span class="si">%f</span><span class="s">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">open_position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">close_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">logdebug</span><span class="p">(</span><span class="s">&quot;Calibrate Advanced Close: </span><span class="si">%f</span><span class="s">&quot;</span><span class="o">%</span><span class="bp">self</span><span class="o">.</span><span class="n">close_position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Gripper.gripped"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Gripper.gripped">[docs]</a>    <span class="k">def</span> <span class="nf">gripped</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checks if an object has been gripped</span>
<span class="sd">            </span>
<span class="sd">            :return True is object is gripped</span>
<span class="sd">            :rtype: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#print &quot;max open %f, max close %f, cur pos %f&quot;%(self.open_position,self.close_position,self.position())</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;electric&#39;</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
            <span class="n">cur_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position</span><span class="p">()</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">logdebug</span><span class="p">(</span><span class="s">&quot;check electric grip with epsilon at close position </span><span class="si">%f</span><span class="s"> open position </span><span class="si">%f</span><span class="s"> current </span><span class="si">%f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close_position</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">open_position</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span><span class="n">cur_pos</span><span class="p">)</span> <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outside_grip</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cur_pos</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">close_position</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">cur_pos</span> <span class="o">&lt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">open_position</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">):</span>
                    <span class="k">return</span> <span class="bp">True</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;suction&#39;</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gripping</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="Gripper.grip"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Gripper.grip">[docs]</a>    <span class="k">def</span> <span class="nf">grip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">blocking</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Closes the gripper if outside grip and opens it otherwise </span>
<span class="sd">            </span>
<span class="sd">            :param blocking :If True, the method waits until the gripper finished the grip</span>
<span class="sd">            :type blocking: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#print &quot;outside grip set to:&quot;,self.outside_grip</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;electric&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outside_grip</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">blocking</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">blocking</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;suction&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">blocking</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Gripper.release"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Gripper.release">[docs]</a>    <span class="k">def</span> <span class="nf">release</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">blocking</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Opens the gripper if outside grip and closes it otherwise</span>
<span class="sd">            </span>
<span class="sd">            :param blocking :If True, the method waits until the gripper finished the release</span>
<span class="sd">            :type blocking: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c">#print &quot;outside grip set to:&quot;,self.outside_grip</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;electric&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">outside_grip</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">blocking</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">blocking</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="s">&#39;suction&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">blocking</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">side</span><span class="p">)</span>
            </div></div>
<div class="viewcode-block" id="BaxterDisplay"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterDisplay">[docs]</a><span class="k">class</span> <span class="nc">BaxterDisplay</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handles the image publishing to the display of baxter</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">show_local</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :param show_local: If True it show a clone window of baxter&#39;s screen on the workstation computer</span>
<span class="sd">            :type show_local: bool  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_display_pub</span><span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">&#39;/robot/xdisplay&#39;</span><span class="p">,</span><span class="n">Image</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">show_local</span>  <span class="o">=</span> <span class="n">show_local</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_width</span><span class="o">=</span><span class="mi">1024</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display_height</span><span class="o">=</span><span class="mi">600</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bridge</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">.</span><span class="n">CvBridge</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_local</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">w_name</span> <span class="o">=</span> <span class="s">&quot;Baxter&#39;s Display&quot;</span>
            <span class="n">cv</span><span class="o">.</span><span class="n">NamedWindow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_name</span><span class="p">,</span> <span class="n">cv</span><span class="o">.</span><span class="n">CV_WINDOW_AUTOSIZE</span><span class="p">)</span>
    
<div class="viewcode-block" id="BaxterDisplay.setImage"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterDisplay.setImage">[docs]</a>    <span class="k">def</span> <span class="nf">setImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Sends the image to the display of the robot and displays the image locally</span>
<span class="sd">            </span>
<span class="sd">            :param data: The image data can be passed as a sensor_msgs.msg.Image() or a string that contains the path to an image file.</span>
<span class="sd">            :type data: sensor_msgs.msgs.Image or str</span>
<span class="sd">        &quot;&quot;&quot;</span>
<span class="c">#         print &quot;got image data&quot;,type(data)</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">img</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">LoadImage</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>        
            <span class="n">data</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">.</span><span class="n">CvBridge</span><span class="p">()</span><span class="o">.</span><span class="n">cv_to_imgmsg</span><span class="p">(</span><span class="n">img</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_local</span><span class="p">:</span>
            <span class="c">#print &quot;image type&quot;,type(data),&quot;data&quot;, data</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bridge</span><span class="o">.</span><span class="n">imgmsg_to_cv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s">&quot;bgr8&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">cv_bridge</span><span class="o">.</span><span class="n">CvBridgeError</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
             
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">show_local</span><span class="p">:</span>
            <span class="n">res_fac</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">dst</span> <span class="o">=</span> <span class="n">cv</span><span class="o">.</span><span class="n">CreateImage</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">display_width</span><span class="o">/</span><span class="n">res_fac</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">display_height</span><span class="o">/</span><span class="n">res_fac</span><span class="p">),</span><span class="mi">8</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">cv</span><span class="o">.</span><span class="n">Resize</span><span class="p">(</span><span class="n">img</span><span class="p">,</span><span class="n">dst</span><span class="p">,</span><span class="n">cv</span><span class="o">.</span><span class="n">CV_INTER_LINEAR</span><span class="p">)</span>
            <span class="n">cv</span><span class="o">.</span><span class="n">ShowImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">w_name</span><span class="p">,</span><span class="n">dst</span><span class="p">)</span>
            <span class="n">cv</span><span class="o">.</span><span class="n">WaitKey</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_display_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ROSException</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
            <span class="k">pass</span>
</div></div>
<div class="viewcode-block" id="BaxterTextDisplayer"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterTextDisplayer">[docs]</a><span class="k">class</span> <span class="nc">BaxterTextDisplayer</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Emulates a terminal style output window to write text information to baxter&#39;s display</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">datapath</span><span class="p">,</span><span class="n">display</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :param datapath: Path to the data directory that also contains a font file that is used for the text style</span>
<span class="sd">            :type datapath: str</span>
<span class="sd">            :param display: Uses the display object to send the created &quot;text image&quot; to the screen of baxter</span>
<span class="sd">            :type display: BaxterDisplay</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">=</span><span class="n">Post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>      
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tmpfile</span><span class="o">=</span> <span class="n">datapath</span><span class="o">+</span><span class="s">&quot;display.jpg&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fontfile</span><span class="o">=</span><span class="n">datapath</span><span class="o">+</span><span class="s">&quot;font/UbuntuMono-R.ttf&quot;</span>
        <span class="c">#print &quot;fontfile&quot;,self.fontfile</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayer</span><span class="o">=</span><span class="n">ImageTextDisplayer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fontfile</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autorefresh</span><span class="o">=</span><span class="bp">False</span>
        
<div class="viewcode-block" id="BaxterTextDisplayer.log"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterTextDisplayer.log">[docs]</a>    <span class="k">def</span> <span class="nf">log</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="p">,</span><span class="n">refresh</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Adds a new line to the output terminal</span>
<span class="sd">            </span>
<span class="sd">            :param text: Text to be written</span>
<span class="sd">            :type text: str</span>
<span class="sd">            :param refresh: If the output should be directly updated</span>
<span class="sd">            :type refresh: bool</span>
<span class="sd">             </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">+</span><span class="n">text</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
          <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="BaxterTextDisplayer.clear"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterTextDisplayer.clear">[docs]</a>    <span class="k">def</span> <span class="nf">clear</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">refresh</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Removes all text from the terminal</span>
<span class="sd">            </span>
<span class="sd">            :param refresh: If the output should be directly updated</span>
<span class="sd">            :type refresh: bool </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="o">=</span><span class="s">&quot;&quot;</span>
        <span class="k">if</span> <span class="n">refresh</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="BaxterTextDisplayer.write"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterTextDisplayer.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Adds a new line to the output terminal</span>
<span class="sd">            </span>
<span class="sd">            :param data: Data to be written -&gt; converted to string</span>
<span class="sd">            :type data: any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
        </div>
<div class="viewcode-block" id="BaxterTextDisplayer.refresh"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterTextDisplayer.refresh">[docs]</a>    <span class="k">def</span> <span class="nf">refresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Updates the screen with the current saved text</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">displayer</span><span class="o">.</span><span class="n">drawText</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmpfile</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">text</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tmpfile</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaxterTextDisplayer.autoRefresh"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterTextDisplayer.autoRefresh">[docs]</a>    <span class="k">def</span> <span class="nf">autoRefresh</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">period</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Starts a loop that automatically updates the screen (Qttention: This function is blocking. Should be called with post)</span>
<span class="sd">            </span>
<span class="sd">            :param period: The time between the updates of the screen</span>
<span class="sd">            :type period: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">autorefresh</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">autorefresh</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">refresh</span><span class="p">()</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
<span class="c">#         self.refresh()</span>
    </div>
<div class="viewcode-block" id="BaxterTextDisplayer.stopAutoRefresh"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterTextDisplayer.stopAutoRefresh">[docs]</a>    <span class="k">def</span> <span class="nf">stopAutoRefresh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Stops the auto refreshing loop</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">autorefresh</span><span class="o">=</span><span class="bp">False</span>
        
</div></div>
<div class="viewcode-block" id="DigitalIO"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.DigitalIO">[docs]</a><span class="k">class</span> <span class="nc">DigitalIO</span><span class="p">(</span><span class="n">baxter_interface</span><span class="o">.</span><span class="n">DigitalIO</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extends DigitalIO with waitForPressed and blinking leds on button presses&quot;&quot;&quot;</span>    
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">led</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led</span> <span class="o">=</span> <span class="n">led</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">=</span><span class="n">Post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enable_state</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">][</span><span class="nb">id</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&quot;shoulder&quot;</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">baxter_interface</span><span class="o">.</span><span class="n">DigitalIO</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">id</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lid</span> <span class="o">=</span> <span class="s">&quot;left_itb_light_inner&quot;</span>
        <span class="k">elif</span> <span class="nb">id</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lid</span> <span class="o">=</span> <span class="s">&quot;right_itb_light_inner&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;No valid button selected&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="nf">__activateLed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Activates a led to blink for some time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">blink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">lid</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    
<div class="viewcode-block" id="DigitalIO.waitForClick"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.DigitalIO.waitForClick">[docs]</a>    <span class="k">def</span> <span class="nf">waitForClick</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Waits for a press on the button</span>
<span class="sd">        &quot;&quot;&quot;</span>                
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span> <span class="c"># Wait pressed</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.07</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__activateLed</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span> <span class="c"># Wait released</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.07</span><span class="p">)</span>
            </div>
<div class="viewcode-block" id="DigitalIO.callbackOnPressed"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.DigitalIO.callbackOnPressed">[docs]</a>    <span class="k">def</span> <span class="nf">callbackOnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Invokes a callback on a button press. This function is non blocking</span>
<span class="sd">            </span>
<span class="sd">            :param callback: function to be called </span>
<span class="sd">            :type callback: any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">__callbackOnPressed</span><span class="p">(</span><span class="n">callback</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__callbackOnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Invokes a callback on a button press. This is a blocking function</span>
<span class="sd">            </span>
<span class="sd">            :param callback: function to be called</span>
<span class="sd">            :type callback: any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_state</span><span class="p">)</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span> <span class="c"># Wait pressed</span>
            <span class="k">if</span> <span class="n">last</span> <span class="ow">is</span> <span class="p">(</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_state</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">enable_state</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__activateLed</span><span class="p">()</span>
                <span class="n">callback</span><span class="p">()</span>
            <span class="n">last</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">state</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        
</div>
<div class="viewcode-block" id="Navigator"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Navigator">[docs]</a><span class="k">class</span> <span class="nc">Navigator</span><span class="p">(</span><span class="n">baxter_interface</span><span class="o">.</span><span class="n">Navigator</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extends Navigator with waitForPressed  and pressed callbacks Navigator</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">,</span><span class="n">led</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :param id: Name of the led</span>
<span class="sd">            :type id: str</span>
<span class="sd">            :param led: object to control a led</span>
<span class="sd">            :type led: baxter_helper.Led  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led</span> <span class="o">=</span> <span class="n">led</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">=</span><span class="n">Post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Navigator</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="nb">id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="nb">id</span> <span class="o">+</span> <span class="s">&quot;_itb_light_inner&quot;</span>
        
<div class="viewcode-block" id="Navigator.activateLed"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Navigator.activateLed">[docs]</a>    <span class="k">def</span> <span class="nf">activateLed</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Activates a led to blink for some time</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">!=</span><span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">blink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">4</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="Navigator.waitForClickOk"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Navigator.waitForClickOk">[docs]</a>    <span class="k">def</span> <span class="nf">waitForClickOk</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Waits until the wheel button has been pressed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__waitForClick</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">button0</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Navigator.waitForClickCancel"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Navigator.waitForClickCancel">[docs]</a>    <span class="k">def</span> <span class="nf">waitForClickCancel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Waits until the arrow button has been pressed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__waitForClick</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Navigator.waitForClickShow"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Navigator.waitForClickShow">[docs]</a>    <span class="k">def</span> <span class="nf">waitForClickShow</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Waits until the home button has been pressed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__waitForClick</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2</span><span class="p">)</span>
        
        </div>
    <span class="k">def</span> <span class="nf">__waitForClick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">statefunc</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Waits until a button has been pressed</span>
<span class="sd">            </span>
<span class="sd">            :param statefunc: Function to be called on button press </span>
<span class="sd">            :type statefunc: any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span> <span class="ow">and</span> <span class="n">statefunc</span><span class="p">()</span><span class="o">==</span><span class="bp">False</span><span class="p">:</span> <span class="c"># Wait pressed</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">activateLed</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span> <span class="ow">and</span> <span class="n">statefunc</span><span class="p">()</span><span class="o">==</span><span class="bp">True</span><span class="p">:</span> <span class="c"># Wait released</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
                
<div class="viewcode-block" id="Navigator.callbackOnPressedOk"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Navigator.callbackOnPressedOk">[docs]</a>    <span class="k">def</span> <span class="nf">callbackOnPressedOk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Invokes a callback on a press on the wheel button. This is a non-blocking function</span>
<span class="sd">            </span>
<span class="sd">            :param callback: function to be called </span>
<span class="sd">            :type callback: any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbackOnPressed</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">button0</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Navigator.callbackOnPressedCancel"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Navigator.callbackOnPressedCancel">[docs]</a>    <span class="k">def</span> <span class="nf">callbackOnPressedCancel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Invokes a callback on a press on the arrow button. This is a non-blocking function</span>
<span class="sd">            </span>
<span class="sd">            :param callback: function to be called</span>
<span class="sd">            :type callback: any </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbackOnPressed</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">button1</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="Navigator.callbackOnPressedShow"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Navigator.callbackOnPressedShow">[docs]</a>    <span class="k">def</span> <span class="nf">callbackOnPressedShow</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Invokes a callback on a press on the home button. This is a non-blocking function</span>
<span class="sd">            </span>
<span class="sd">            :param callback: function to be called </span>
<span class="sd">            :type callback: any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_callbackOnPressed</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">button2</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Navigator.callbackWheel"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Navigator.callbackWheel">[docs]</a>    <span class="k">def</span> <span class="nf">callbackWheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Invokes a callback on a rotation of the wheel button. This is a non-blocking function</span>
<span class="sd">            </span>
<span class="sd">            :param callback: function to be called </span>
<span class="sd">            :type callback: any</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">__callbackWheel</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wheel</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>
        </div>
    <span class="k">def</span> <span class="nf">__callbackWheel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">statefunc</span><span class="p">,</span> <span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Invokes a callback on a wheel rotations. This is a blocking function</span>
<span class="sd">            </span>
<span class="sd">            :param statefunc: wheel position </span>
<span class="sd">            :type statefunc: int</span>
<span class="sd">            :param callback: function to be called</span>
<span class="sd">            :type callback: any </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last</span> <span class="o">=</span> <span class="n">statefunc</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
            <span class="n">newstate</span> <span class="o">=</span> <span class="n">statefunc</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">last</span> <span class="ow">is</span> <span class="n">newstate</span><span class="p">:</span>            
                <span class="bp">self</span><span class="o">.</span><span class="n">activateLed</span><span class="p">()</span>
                <span class="n">callback</span><span class="p">(</span><span class="n">newstate</span><span class="p">)</span>
                <span class="n">last</span> <span class="o">=</span> <span class="n">newstate</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_callbackOnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">statefunc</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Invokes a callback on a button press. This function is non blocking</span>
<span class="sd">            </span>
<span class="sd">            :param statefunc: button state </span>
<span class="sd">            :type statefunc: bool</span>
<span class="sd">            :param callback: function to be called </span>
<span class="sd">            :type callback: any </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">__callbackOnPressed</span><span class="p">(</span><span class="n">statefunc</span><span class="p">,</span><span class="n">callback</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__callbackOnPressed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">statefunc</span><span class="p">,</span><span class="n">callback</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Invokes a callback on a button press. This is a blocking function</span>
<span class="sd">            </span>
<span class="sd">            :param callback: function to be called </span>
<span class="sd">            :type callback: any </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">last</span><span class="o">=</span><span class="n">statefunc</span><span class="p">()</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span> <span class="c"># Wait pressed</span>
            <span class="n">newstate</span><span class="o">=</span><span class="n">statefunc</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">last</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">newstate</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">activateLed</span><span class="p">()</span>
                <span class="n">callback</span><span class="p">()</span>
            <span class="n">last</span><span class="o">=</span><span class="n">newstate</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
        
        </div>
<div class="viewcode-block" id="Head"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Head">[docs]</a><span class="k">class</span> <span class="nc">Head</span><span class="p">(</span><span class="n">baxter_interface</span><span class="o">.</span><span class="n">Head</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">baxter_interface</span><span class="o">.</span><span class="n">Head</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">=</span><span class="n">Post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

<div class="viewcode-block" id="Head.command_deny"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Head.command_deny">[docs]</a>    <span class="k">def</span> <span class="nf">command_deny</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Command the shake head  &quot;No&quot;</span>

<span class="sd">        :param timeout: Seconds to wait for the head to shake. If 0, just command once and return.  [0]</span>
<span class="sd">        :type timeout: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pan</span><span class="p">(</span><span class="o">-</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pan</span><span class="p">(</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_pan</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        </div></div>
<div class="viewcode-block" id="Led"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Led">[docs]</a><span class="k">class</span> <span class="nc">Led</span><span class="p">():</span> 
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Class to control all leds</span>
<span class="sd">            Available leds are:</span>
<span class="sd">            * &#39;left_itb_light_outer&#39;,</span>
<span class="sd">            * &#39;left_itb_light_inner&#39;,</span>
<span class="sd">            * &#39;right_itb_light_outer&#39;,</span>
<span class="sd">            * &#39;right_itb_light_inner&#39;,</span>
<span class="sd">            * &#39;torso_left_itb_light_outer&#39;,</span>
<span class="sd">            * &#39;torso_left_itb_light_inner&#39;,</span>
<span class="sd">            * &#39;torso_right_itb_light_outer&#39;,</span>
<span class="sd">            * &#39;torso_right_itb_light_inner&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">led_names</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;left_itb_light_outer&#39;</span><span class="p">,</span><span class="s">&#39;left_itb_light_inner&#39;</span><span class="p">,</span> 
                          <span class="s">&#39;right_itb_light_outer&#39;</span><span class="p">,</span> <span class="s">&#39;right_itb_light_inner&#39;</span><span class="p">,</span>
                          <span class="s">&#39;torso_left_itb_light_outer&#39;</span><span class="p">,</span><span class="s">&#39;torso_left_itb_light_inner&#39;</span><span class="p">,</span>
                          <span class="s">&#39;torso_right_itb_light_outer&#39;</span><span class="p">,</span><span class="s">&#39;torso_right_itb_light_inner&#39;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led_handle</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led_state</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">led</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">led_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">led_handle</span><span class="p">[</span><span class="n">led</span><span class="p">]</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">DigitalIO</span><span class="p">(</span><span class="n">led</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">led_state</span><span class="p">[</span><span class="n">led</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
<div class="viewcode-block" id="Led.enable"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Led.enable">[docs]</a>    <span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Enables a Led</span>
<span class="sd">            </span>
<span class="sd">            :param name: Name of the led </span>
<span class="sd">            :type name: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led_handle</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led_state</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
    </div>
<div class="viewcode-block" id="Led.disable"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Led.disable">[docs]</a>    <span class="k">def</span> <span class="nf">disable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">):</span>   
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Disables a Led</span>
<span class="sd">            </span>
<span class="sd">            :param name: Name of the led</span>
<span class="sd">            :type name: str</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">led_handle</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led_state</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">pass</span>
    </div>
<div class="viewcode-block" id="Led.disableAll"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Led.disableAll">[docs]</a>    <span class="k">def</span> <span class="nf">disableAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Disables all leds</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">led</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">led_names</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable</span><span class="p">(</span><span class="n">led</span><span class="p">)</span>
        
    </div>
<div class="viewcode-block" id="Led.blink"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Led.blink">[docs]</a>    <span class="k">def</span> <span class="nf">blink</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">frequency</span><span class="o">=</span><span class="mf">2.0</span><span class="p">):</span> <span class="c">#timeout &lt;= 0 blinks endlessly</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Blinks a led for a specific time and frequency (blocking)</span>
<span class="sd">            </span>
<span class="sd">            :param name: Name of the led</span>
<span class="sd">            :type name: str</span>
<span class="sd">            :param timeout: Duration to let the led blinking. A value &lt;= 0.0 means infinite time</span>
<span class="sd">            :type timeout: float</span>
<span class="sd">            :param frequency: Rate, how often a led blinks in one second</span>
<span class="sd">            :type frequency: float   </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">+</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led_state</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">():</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">start</span> <span class="o">&gt;</span> <span class="n">end</span> <span class="ow">and</span> <span class="n">timeout</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">led_state</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">led_handle</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">led_handle</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="n">frequency</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">led_handle</span><span class="p">[</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">set_output</span><span class="p">(</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="n">frequency</span><span class="o">*</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
            </div>
<div class="viewcode-block" id="Led.blinkAllOuter"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Led.blinkAllOuter">[docs]</a>    <span class="k">def</span> <span class="nf">blinkAllOuter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">frequency</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Blinks with all blue leds for a specific time and frequency (blocking)</span>
<span class="sd">            </span>
<span class="sd">            :param timeout: Duration to let the leds blinking. A value &lt;= 0.0 means infinite time</span>
<span class="sd">            :type timeout: float</span>
<span class="sd">            :param frequency: Rate, how often all leds blink in one second</span>
<span class="sd">            :type frequency: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">led</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">led_names</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">blink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">led_names</span><span class="p">[</span><span class="n">led</span><span class="p">],</span><span class="n">timeout</span><span class="p">,</span><span class="n">frequency</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="Led.blinkAllInner"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Led.blinkAllInner">[docs]</a>    <span class="k">def</span> <span class="nf">blinkAllInner</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">frequency</span><span class="o">=</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Blinks with all white leds for a specific time and frequency (blocking)</span>
<span class="sd">            </span>
<span class="sd">            :param timeout: Duration to let the leds blinking. A value &lt;= 0.0 means infinite time</span>
<span class="sd">            :type timeout: float</span>
<span class="sd">            :param frequency: Rate, how often all leds blink in one second  </span>
<span class="sd">            :type frequency: float </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">led</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">led_names</span><span class="p">),</span><span class="mi">2</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">blink</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">led_names</span><span class="p">[</span><span class="n">led</span><span class="p">],</span><span class="n">timeout</span><span class="p">,</span><span class="n">frequency</span><span class="p">)</span>      
 </div></div>
<div class="viewcode-block" id="Tee"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Tee">[docs]</a><span class="k">class</span> <span class="nc">Tee</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t1</span><span class="p">,</span><span class="n">t2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t1</span><span class="o">=</span><span class="n">t1</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">=</span><span class="n">t2</span>
        
<div class="viewcode-block" id="Tee.write"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Tee.write">[docs]</a>    <span class="k">def</span> <span class="nf">write</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t1</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">t2</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>       
    </div>
<div class="viewcode-block" id="Tee.isatty"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.Tee.isatty">[docs]</a>    <span class="k">def</span> <span class="nf">isatty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">True</span>
   </div></div>
<div class="viewcode-block" id="BaxterCamera"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterCamera">[docs]</a><span class="k">class</span> <span class="nc">BaxterCamera</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">display</span><span class="p">,</span> <span class="n">textDisplay</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            :param display: sends image to the screen of baxter</span>
<span class="sd">            :type display: BaxterDisplay</span>
<span class="sd">            :param textDisplay: enables and disables the autorefresh</span>
<span class="sd">            :type textDisplay: BaxterTextDisplayer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span> <span class="o">=</span> <span class="n">Post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span> <span class="o">=</span> <span class="n">textDisplay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span> <span class="o">=</span> <span class="n">display</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscribers</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera_list</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__getAllCameras</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closeAllCameras</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">img_id</span><span class="o">=</span><span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bridge</span> <span class="o">=</span> <span class="n">cv_bridge</span><span class="o">.</span><span class="n">CvBridge</span><span class="p">()</span>

<div class="viewcode-block" id="BaxterCamera.grabImage"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterCamera.grabImage">[docs]</a>    <span class="k">def</span> <span class="nf">grabImage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">camera_name</span><span class="p">,</span><span class="n">filename</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Grabs exactly one image from a camera</span>
<span class="sd">            </span>
<span class="sd">            :param camera_name: The image of the camera that should be saved</span>
<span class="sd">            :type camera_name: str</span>
<span class="sd">            :param filename: The full path of the filename where this image should be saved</span>
<span class="sd">            :type filename: str </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">startCamera</span><span class="p">(</span><span class="n">camera_name</span><span class="p">,</span><span class="n">open_only</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span> <span class="p">(</span><span class="mi">640</span><span class="p">,</span><span class="mi">400</span><span class="p">))</span>
        <span class="n">msg</span><span class="o">=</span><span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_message</span><span class="p">(</span><span class="s">&#39;/cameras/&#39;</span> <span class="o">+</span> <span class="n">camera_name</span> <span class="o">+</span> <span class="s">&quot;/image&quot;</span><span class="p">,</span> <span class="n">Image</span><span class="p">)</span>        
        <span class="n">img</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bridge</span><span class="o">.</span><span class="n">imgmsg_to_cv</span><span class="p">(</span><span class="n">msg</span><span class="p">,</span> <span class="s">&quot;bgr8&quot;</span><span class="p">)</span>
        <span class="n">cv</span><span class="o">.</span><span class="n">SaveImage</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span><span class="n">img</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Saved Image </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="n">filename</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">closeCamera</span><span class="p">(</span><span class="n">camera_name</span><span class="p">)</span>
<span class="c">#         cv.NamedWindow(filename, cv.CV_WINDOW_AUTOSIZE)</span>
<span class="c">#         cv.ShowImage(filename,img)</span>
<span class="c">#         cv.WaitKey(30)</span>
        </div>
    <span class="k">def</span> <span class="nf">__getAllCameras</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Gets all available cameras from the robot and create a controller for them</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">srv</span> <span class="o">=</span> <span class="s">&quot;/cameras/list&quot;</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_service</span><span class="p">(</span><span class="n">srv</span><span class="p">,</span> <span class="mf">5.0</span><span class="p">)</span>
            <span class="n">camera_list_srv</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">ServiceProxy</span><span class="p">(</span><span class="n">srv</span><span class="p">,</span> <span class="n">ListCameras</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera_list</span> <span class="o">=</span> <span class="n">camera_list_srv</span><span class="p">()</span><span class="o">.</span><span class="n">cameras</span>            
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">camera_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_list</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">camera_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">baxter_interface</span><span class="o">.</span><span class="n">CameraController</span><span class="p">(</span><span class="n">camera_name</span><span class="p">)</span>            
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span>
        
<div class="viewcode-block" id="BaxterCamera.closeAllCameras"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterCamera.closeAllCameras">[docs]</a>    <span class="k">def</span> <span class="nf">closeAllCameras</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Closes all active cameras</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">camera_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subscribers</span><span class="p">[</span><span class="n">camera_name</span><span class="p">]</span><span class="o">.</span><span class="n">unregister</span><span class="p">()</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribers</span><span class="p">[</span><span class="n">camera_name</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">camera_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">camera_name</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="c">#         if self.textDisplay.autorefresh == False:</span>
<span class="c">#                 self.textDisplay.post.autoRefresh(1)</span>
            </div>
<div class="viewcode-block" id="BaxterCamera.listCameras"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterCamera.listCameras">[docs]</a>    <span class="k">def</span> <span class="nf">listCameras</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Return a list of all available cameras</span>
<span class="sd">            </span>
<span class="sd">            :return: Available camera names</span>
<span class="sd">            :rtype: list(str)  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera_list</span>
       </div>
<div class="viewcode-block" id="BaxterCamera.startCamera"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterCamera.startCamera">[docs]</a>    <span class="k">def</span> <span class="nf">startCamera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">camera_name</span><span class="p">,</span><span class="n">open_only</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">resolution</span><span class="o">=</span> <span class="p">(</span><span class="mi">960</span><span class="p">,</span> <span class="mi">600</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Opens a camera</span>
<span class="sd">            </span>
<span class="sd">            :param camera_name: Name of the camera to be used</span>
<span class="sd">            :type camera_name: str</span>
<span class="sd">            :param open_only: If True only opens the camera stream, otherwise the stream is also redirected to the display</span>
<span class="sd">            :type open_only: bool</span>
<span class="sd">            :param resolution: Resolution of the camera stream</span>
<span class="sd">            :type resolution: (int,int) </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">camera_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">camera</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">camera_name</span><span class="p">]</span>
            <span class="n">camera</span><span class="o">.</span><span class="n">resolution</span> <span class="o">=</span><span class="n">resolution</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">camera</span><span class="o">.</span><span class="n">open</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="s">&quot;could not open the camera. error: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="n">open_only</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="o">.</span><span class="n">autorefresh</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="o">.</span><span class="n">autorefresh</span> <span class="o">=</span> <span class="bp">False</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subscribers</span><span class="p">[</span><span class="n">camera_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="s">&#39;/cameras/&#39;</span> <span class="o">+</span> <span class="n">camera_name</span> <span class="o">+</span> <span class="s">&quot;/image&quot;</span><span class="p">,</span> <span class="n">Image</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">__republish</span><span class="p">,</span><span class="bp">None</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="s">&quot;camera not found&quot;</span><span class="p">)</span>
    </div>
    <span class="k">def</span> <span class="nf">__republish</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Sends the camera image to baxter&#39;s display</span>
<span class="sd">        &quot;&quot;&quot;</span>              
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">setImage</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>

<div class="viewcode-block" id="BaxterCamera.closeCamera"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterCamera.closeCamera">[docs]</a>    <span class="k">def</span> <span class="nf">closeCamera</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">camera_name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Closes a specific camera</span>
<span class="sd">            </span>
<span class="sd">            :param camera_name: The name of the camera to be closed </span>
<span class="sd">            :type camera_name: str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">camera_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribers</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subscribers</span><span class="p">[</span><span class="n">camera_name</span><span class="p">]</span><span class="o">.</span><span class="n">unregister</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cameras</span><span class="p">[</span><span class="n">camera_name</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">subscribers</span><span class="p">[</span><span class="n">camera_name</span><span class="p">]</span>
<span class="c">#             if self.textDisplay.autorefresh == False:</span>
<span class="c">#                 self.textDisplay.post.autoRefresh(1)</span>
            <span class="c">#print &quot;camera closed, autorefresh enabled&quot;</span>
</div></div>
<div class="viewcode-block" id="BaxterRangeSensor"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRangeSensor">[docs]</a><span class="k">class</span> <span class="nc">BaxterRangeSensor</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the distances from the range sensors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__distance</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;left&quot;</span><span class="p">:</span><span class="n">Lock</span><span class="p">(),</span><span class="s">&quot;right&quot;</span><span class="p">:</span><span class="n">Lock</span><span class="p">()}</span>
        <span class="n">root_name</span> <span class="o">=</span> <span class="s">&quot;/robot/range/&quot;</span>
        <span class="n">sensor_name</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;left_hand_range/state&quot;</span><span class="p">,</span><span class="s">&quot;right_hand_range/state&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__left_sensor</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="n">root_name</span> <span class="o">+</span> <span class="n">sensor_name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">Range</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__sensorCallback</span><span class="p">,</span> <span class="n">callback_args</span><span class="o">=</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__right_sensor</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Subscriber</span><span class="p">(</span><span class="n">root_name</span> <span class="o">+</span> <span class="n">sensor_name</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">Range</span><span class="p">,</span> <span class="n">callback</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">__sensorCallback</span><span class="p">,</span> <span class="n">callback_args</span><span class="o">=</span><span class="s">&quot;right&quot;</span><span class="p">,</span><span class="n">queue_size</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">__sensorCallback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">msg</span><span class="p">,</span><span class="n">side</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Updates the last saved distance value</span>
<span class="sd">            </span>
<span class="sd">            :param msg: Range msg of the distance sensor</span>
<span class="sd">            :type msg: sensor_msgs.msg.Range</span>
<span class="sd">            :param side: Side of the sensor</span>
<span class="sd">            :type side: str  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">[</span><span class="n">side</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__distance</span><span class="p">[</span><span class="n">side</span><span class="p">]</span> <span class="o">=</span> <span class="n">msg</span><span class="o">.</span><span class="n">range</span>  
        
<div class="viewcode-block" id="BaxterRangeSensor.getDistance"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRangeSensor.getDistance">[docs]</a>    <span class="k">def</span> <span class="nf">getDistance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Return the last saved distance value</span>
<span class="sd">            </span>
<span class="sd">            :return: Distance in meters</span>
<span class="sd">            :rtype: float </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">__mutex</span><span class="p">[</span><span class="n">side</span><span class="p">]:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__distance</span><span class="p">[</span><span class="n">side</span><span class="p">]</span>

</div></div>
<div class="viewcode-block" id="BaxterCollisionAvoidance"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterCollisionAvoidance">[docs]</a><span class="k">class</span> <span class="nc">BaxterCollisionAvoidance</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class to enable and disable the self-collision avoidance. Useful when the robot has to pass objects from one hand to the other</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub1</span><span class="o">=</span><span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">&quot;/robot/limb/left/suppress_collision_avoidance&quot;</span><span class="p">,</span><span class="n">Empty</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pub2</span><span class="o">=</span><span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">&quot;/robot/limb/right/suppress_collision_avoidance&quot;</span><span class="p">,</span><span class="n">Empty</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">=</span><span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">=</span><span class="bp">None</span>
        
<div class="viewcode-block" id="BaxterCollisionAvoidance.deactivate"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterCollisionAvoidance.deactivate">[docs]</a>    <span class="k">def</span> <span class="nf">deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">timeout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Deactivates the self-collision avoidance for a specific amount of time (non-blocking) </span>
<span class="sd">            </span>
<span class="sd">            :param timeout: How long the collision avoidance is disabled </span>
<span class="sd">            :type timeout: float </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">=</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="k">lambda</span> <span class="n">timeout</span><span class="o">=</span><span class="n">timeout</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">__deactivate</span><span class="p">(</span><span class="n">timeout</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">=</span><span class="bp">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="BaxterCollisionAvoidance.activate"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterCollisionAvoidance.activate">[docs]</a>    <span class="k">def</span> <span class="nf">activate</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Reactivates the self-collision avoidance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">running</span><span class="o">=</span><span class="bp">False</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</div>
    <span class="k">def</span> <span class="nf">__deactivate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">_timeout</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Worker thread to deactivate the collision avoidance (blocking)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">r</span><span class="o">=</span><span class="n">rospy</span><span class="o">.</span><span class="n">Rate</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">timeout</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Duration</span><span class="p">(</span><span class="n">_timeout</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;WARNING: COLLISION AVOIDANCE DEACTIVATED FOR </span><span class="si">%f</span><span class="s"> SECONDS&quot;</span><span class="o">%</span><span class="n">timeout</span><span class="o">.</span><span class="n">to_sec</span><span class="p">())</span>
        <span class="n">empty</span><span class="o">=</span><span class="n">Empty</span><span class="p">()</span>
        <span class="k">while</span> <span class="bp">self</span><span class="o">.</span><span class="n">running</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="n">_timeout</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">Time</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">-</span><span class="n">start</span><span class="p">)</span><span class="o">&lt;</span><span class="n">timeout</span><span class="p">):</span>
            <span class="c">#print &quot;WARNING: COLLISION AVOIDANCE DEACTIVATED&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pub1</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pub2</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">empty</span><span class="p">)</span>
            <span class="n">r</span><span class="o">.</span><span class="n">sleep</span><span class="p">()</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">thread</span><span class="o">=</span><span class="bp">None</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;WARNING: COLLISION AVOIDANCE REACTIVATED&quot;</span><span class="p">)</span> 
</div>
<div class="viewcode-block" id="BaxterSonar"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterSonar">[docs]</a><span class="k">class</span> <span class="nc">BaxterSonar</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Enables or disables the sonar sensors</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sonar_pub</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">&quot;/robot/sonar/head_sonar/set_sonars_enabled&quot;</span><span class="p">,</span><span class="n">UInt16</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        
<div class="viewcode-block" id="BaxterSonar.checkConnection"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterSonar.checkConnection">[docs]</a>    <span class="k">def</span> <span class="nf">checkConnection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Checks if baxter&#39;s sonars already subscribed to the publisher</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sonar_pub</span><span class="o">.</span><span class="n">get_num_connections</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
           <span class="c"># rospy.logwarn(&quot;No subscriber for sonar state found yet&quot;)</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Found a subscriber. Changing sonar state&quot;</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="BaxterSonar.enable"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterSonar.enable">[docs]</a>    <span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Enables all sonar sensors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkConnection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">4095</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sonar_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="mi">4095</span><span class="p">)</span>
        </div>
<div class="viewcode-block" id="BaxterSonar.disable"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterSonar.disable">[docs]</a>    <span class="k">def</span> <span class="nf">disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Disables all sonar sensors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">checkConnection</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">state</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sonar_pub</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="BaxterRobot"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot">[docs]</a><span class="k">class</span> <span class="nc">BaxterRobot</span><span class="p">:</span>
    <span class="n">__metaclass__</span><span class="o">=</span><span class="n">Singleton</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Principal class that holds interfaces to:</span>
<span class="sd">        </span>
<span class="sd">        * enable/disable the motors</span>
<span class="sd">        * the range sensors</span>
<span class="sd">        * the menu</span>
<span class="sd">        * the collision avoidance</span>
<span class="sd">        * the display</span>
<span class="sd">        * the text display</span>
<span class="sd">        * the cameras</span>
<span class="sd">        * the tf frames</span>
<span class="sd">        * the grippers</span>
<span class="sd">        * the arms</span>
<span class="sd">        * the leds</span>
<span class="sd">        * the buttons</span>
<span class="sd">        * the recorder</span>
<span class="sd">        * the 3D scene</span>
<span class="sd">        * the urdf creator</span>
<span class="sd">        * and high level motion controller</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">moveit</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param moveit: Defines if MoveIt should be used</span>
<span class="sd">        :type moveit: bool </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pubrate</span><span class="o">=</span><span class="n">rospy</span><span class="o">.</span><span class="n">Publisher</span><span class="p">(</span><span class="s">&quot;/robot/joint_state_publish_rate&quot;</span><span class="p">,</span><span class="n">UInt16</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">moveit</span><span class="o">=</span><span class="n">moveit</span>
        <span class="k">if</span> <span class="n">moveit</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">baxter_helper_moveit_limb</span> <span class="kn">import</span> <span class="n">MoveItHelper</span>
                <span class="n">MoveItHelper</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="s">&quot;Cannot initialize MoveIt. Starting interface without MoveIt. </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">moveit</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">=</span><span class="n">Post</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;left&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s">&quot;right&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">=</span><span class="p">{</span><span class="s">&quot;left&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">,</span><span class="s">&quot;right&quot;</span><span class="p">:</span><span class="bp">None</span><span class="p">}</span>        
        <span class="bp">self</span><span class="o">.</span><span class="n">dio</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">navigator</span><span class="o">=</span><span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">camera</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collision</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabler</span><span class="o">=</span><span class="n">baxter_interface</span><span class="o">.</span><span class="n">RobotEnable</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">=</span><span class="n">Head</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="o">=</span><span class="n">BaxterDisplay</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="o">=</span><span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datapath</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">__file__</span><span class="p">)))</span>  <span class="o">+</span> <span class="s">&quot;/data/&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bb</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasker</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hlm</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">br</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">uc</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sonar</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">kinect</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">while</span> <span class="ow">not</span> <span class="n">rospy</span><span class="o">.</span><span class="n">is_shutdown</span><span class="p">()</span> <span class="ow">and</span> <span class="n">pubrate</span><span class="o">.</span><span class="n">get_num_connections</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">pubrate</span><span class="o">.</span><span class="n">publish</span><span class="p">(</span><span class="n">UInt16</span><span class="p">(</span><span class="n">DEFAULT_RATE</span><span class="p">))</span> 

        <span class="bp">self</span><span class="o">.</span><span class="n">motor_state</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_message</span><span class="p">(</span><span class="s">&quot;/robot/state&quot;</span><span class="p">,</span><span class="n">AssemblyState</span><span class="p">)</span><span class="o">.</span><span class="n">enabled</span>

<div class="viewcode-block" id="BaxterRobot.toggleMotorState"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.toggleMotorState">[docs]</a>    <span class="k">def</span> <span class="nf">toggleMotorState</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Enables or disables the motorstate of the robot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">blinkAllOuter</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor_state</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="BaxterRobot.enable"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.enable">[docs]</a>    <span class="k">def</span> <span class="nf">enable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Enables the motors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor_state</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Motors seem to be already enabled&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motor_state</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabler</span><span class="o">.</span><span class="n">enable</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="BaxterRobot.disable"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.disable">[docs]</a>    <span class="k">def</span> <span class="nf">disable</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Disables the motors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">motor_state</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Motors seem to be already disabled&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">motor_state</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enabler</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span>
        </div>
<div class="viewcode-block" id="BaxterRobot.loadAll"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadAll">[docs]</a>    <span class="k">def</span> <span class="nf">loadAll</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads all interfaces</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">elements</span> <span class="o">=</span> <span class="n">getmembers</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="n">elements</span><span class="o">=</span><span class="p">[</span><span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span> <span class="k">if</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;load&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">e</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&quot;loadAll&quot;</span><span class="p">)]</span>
<span class="c">#         rospy.loginfo(&quot;Elements to load %s&quot;%str(elements))</span>
        <span class="p">[</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">e</span><span class="p">)()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">]</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;All components are loaded.&quot;</span><span class="p">)</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadKinect"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadKinect">[docs]</a>    <span class="k">def</span> <span class="nf">loadKinect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Publishes the transformation from the kinect rgb camera to the marker that is mounted on baxter</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">ar_track_alvar.msg</span> <span class="kn">import</span> <span class="n">AlvarMarkers</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c">#~ rospy.warn(&quot;Cannot import AlvarMarkers -&gt; ignoring TF from camera to marker&quot;)</span>
            <span class="k">return</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">kinect</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadFrame</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">kinect</span> <span class="o">=</span> <span class="n">BaxterKinect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">frame</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kinect</span>
        
    </div>
<div class="viewcode-block" id="BaxterRobot.loadSonarControl"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadSonarControl">[docs]</a>    <span class="k">def</span> <span class="nf">loadSonarControl</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads Baxter&#39;s sonar control and disables the sonars</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the sonar sensors</span>
<span class="sd">            :rtype: BaxterSonar</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span> 
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sonar</span> <span class="o">=</span> <span class="n">BaxterSonar</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sonar</span><span class="o">.</span><span class="n">disable</span><span class="p">()</span> <span class="c"># disables all 12 sonar sensors</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Sonar Control&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sonar</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadRangeSensor"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadRangeSensor">[docs]</a>    <span class="k">def</span> <span class="nf">loadRangeSensor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads Baxter&#39;s range sensors</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the range sensors</span>
<span class="sd">            :rtype: BaxterRangeSensor</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rs</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rs</span> <span class="o">=</span> <span class="n">BaxterRangeSensor</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Range Sensor&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">rs</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadMenuManager"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadMenuManager">[docs]</a>    <span class="k">def</span> <span class="nf">loadMenuManager</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads Baxter&#39;s menu manager</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the menu</span>
<span class="sd">            :rtype: BaxterMenuManager</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadMenu</span><span class="p">()</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mm</span> <span class="o">=</span> <span class="n">BaxterMenuManager</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">menu</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">moveit</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Menu Manager&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mm</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadBehaviors"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadBehaviors">[docs]</a>    <span class="k">def</span> <span class="nf">loadBehaviors</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads Baxter&#39;s custom behaviors</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the behaviors</span>
<span class="sd">            :rtype: BaxterBehaviors</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bb</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">bb</span> <span class="o">=</span> <span class="n">BaxterBehaviors</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Behaviors&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>  
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">bb</span>
</div>
<div class="viewcode-block" id="BaxterRobot.loadCollisionAvoidance"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadCollisionAvoidance">[docs]</a>    <span class="k">def</span> <span class="nf">loadCollisionAvoidance</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads the self-collision avoidance interface</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the self-collision avoidance</span>
<span class="sd">            :rtype: BaxterCollisionAvoidance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collision</span> <span class="o">=</span> <span class="n">BaxterCollisionAvoidance</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Collision Avoidance&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">collision</span>  
    </div>
<div class="viewcode-block" id="BaxterRobot.loadMenu"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadMenu">[docs]</a>    <span class="k">def</span> <span class="nf">loadMenu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads the menu image composer</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to draw and select the menu entries</span>
<span class="sd">            :rtype: BaxterMenuComposer</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadTextDisplay</span><span class="p">()</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> <span class="o">=</span> <span class="n">BaxterMenuComposer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">datapath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Menu Composer&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">menu</span> 
    </div>
<div class="viewcode-block" id="BaxterRobot.loadCamera"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadCamera">[docs]</a>    <span class="k">def</span> <span class="nf">loadCamera</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Prepares the cameras</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the cameras</span>
<span class="sd">            :rtype: BaxterCamera</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">camera</span> <span class="o">=</span> <span class="n">BaxterCamera</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Cameras&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">camera</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadFrame"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadFrame">[docs]</a>    <span class="k">def</span> <span class="nf">loadFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Prepares the tf broadcaster and listener</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the transformations</span>
<span class="sd">            :rtype: BaxterFrame</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loadBaxterScene</span><span class="p">()</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">frame</span> <span class="o">=</span> <span class="n">BaxterFrame</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Frame&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">frame</span>    
    </div>
    <span class="k">def</span> <span class="nf">__loadGripper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">,</span><span class="n">force_reload</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads one gripper</span>
<span class="sd">            </span>
<span class="sd">            :param side: Gripper to be loaded</span>
<span class="sd">            :type side: str  </span>
<span class="sd">            :param force_reload: Recalibrate gripper? </span>
<span class="sd">            :type force_reload: bool </span>
<span class="sd">        &quot;&quot;&quot;</span>   
        <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">=</span><span class="n">Gripper</span><span class="p">(</span><span class="n">side</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">scene</span><span class="p">)</span>
        <span class="n">gripper_id</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">wait_for_message</span><span class="p">(</span><span class="s">&#39;/robot/end_effector/&#39;</span><span class="o">+</span><span class="n">side</span><span class="o">+</span><span class="s">&#39;_gripper/properties&#39;</span><span class="p">,</span><span class="n">EndEffectorProperties</span><span class="p">,</span><span class="mf">5.0</span><span class="p">)</span>
        <span class="n">gripper_name</span> <span class="o">=</span> <span class="n">gripper_id</span><span class="o">.</span><span class="n">product</span>
        <span class="k">if</span> <span class="n">gripper_name</span> <span class="o">==</span> <span class="s">&#39;Electric Parallel Gripper&#39;</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">calibrated</span><span class="p">()</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">or</span> <span class="n">force_reload</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">calibrate</span><span class="p">()</span>
                    <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">.</span><span class="n">calibrateAdvanced</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span><span class="n">e</span><span class="p">:</span>
                <span class="n">rospy</span><span class="o">.</span><span class="n">logerr</span><span class="p">(</span><span class="s">&quot;check also if emergency button is popped out. error: </span><span class="si">%s</span><span class="s">&quot;</span><span class="o">%</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">gripper_name</span> <span class="o">==</span> <span class="s">&#39;Suction Cup Gripper&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Unknown Gripper with name </span><span class="si">%s</span><span class="s"> loaded&quot;</span><span class="o">%</span><span class="n">gripper_name</span><span class="p">)</span> 
    
<div class="viewcode-block" id="BaxterRobot.loadGrippers"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadGrippers">[docs]</a>    <span class="k">def</span> <span class="nf">loadGrippers</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">force_reload</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads both grippers</span>
<span class="sd">            </span>
<span class="sd">            :param force_reload: Recalibrate grippers? </span>
<span class="sd">            :type force_reload: bool</span>
<span class="sd">            :return: interface to the grippers</span>
<span class="sd">            :rtype: Gripper</span>
<span class="sd">        &quot;&quot;&quot;</span> 
        <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadBaxterScene</span><span class="p">()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="p">[</span><span class="s">&quot;left&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="p">[</span><span class="s">&quot;right&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="n">force_reload</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="n">th_left_gripper</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">__loadGripper</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="n">force_reload</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__loadGripper</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">,</span><span class="n">force_reload</span><span class="p">)</span>
            <span class="n">th_left_gripper</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Grippers&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span>
        </div>
    <span class="k">def</span> <span class="nf">__loadArm</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Load an arm</span>
<span class="sd">            </span>
<span class="sd">            :param side: Arm to be loaded</span>
<span class="sd">            :type side: str </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveit</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">baxter_helper_moveit_limb</span> <span class="kn">import</span> <span class="n">MoveItLimb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">=</span><span class="n">MoveItLimb</span><span class="p">(</span><span class="n">side</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">baxter_helper_simple_limb</span> <span class="kn">import</span> <span class="n">SimpleLimb</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="n">side</span><span class="p">]</span><span class="o">=</span><span class="n">SimpleLimb</span><span class="p">(</span><span class="n">side</span><span class="p">,</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.2</span><span class="p">)</span> <span class="c"># wait until subscribers are active</span>
        
<div class="viewcode-block" id="BaxterRobot.loadArms"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadArms">[docs]</a>    <span class="k">def</span> <span class="nf">loadArms</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Load both arms</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the arms/limbs</span>
<span class="sd">            :rtype: SimpleLimb or MoveItLimb</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="s">&quot;left&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="s">&quot;right&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="n">th_left_arm</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">__loadArm</span><span class="p">(</span><span class="s">&quot;left&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__loadArm</span><span class="p">(</span><span class="s">&quot;right&quot;</span><span class="p">)</span>
            <span class="n">th_left_arm</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Arms&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span>
        </div>
<div class="viewcode-block" id="BaxterRobot.loadLeds"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadLeds">[docs]</a>    <span class="k">def</span> <span class="nf">loadLeds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads all leds</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the leds</span>
<span class="sd">            :rtype: Led</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">led</span> <span class="o">=</span> <span class="n">Led</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Leds&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">led</span>
</div>
<div class="viewcode-block" id="BaxterRobot.loadDigitalIO"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadDigitalIO">[docs]</a>    <span class="k">def</span> <span class="nf">loadDigitalIO</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads the buttons</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the buttons</span>
<span class="sd">            :rtype: DigitalIO</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">l</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;right_lower_button&quot;</span><span class="p">,</span><span class="s">&quot;right_upper_button&quot;</span><span class="p">,</span><span class="s">&quot;right_lower_cuff&quot;</span><span class="p">,</span><span class="s">&quot;right_shoulder_button&quot;</span><span class="p">,</span>
           <span class="s">&quot;left_lower_button&quot;</span> <span class="p">,</span><span class="s">&quot;left_upper_button&quot;</span> <span class="p">,</span><span class="s">&quot;left_lower_cuff&quot;</span> <span class="p">,</span><span class="s">&quot;left_shoulder_button&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dio</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadLeds</span><span class="p">()</span>        
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">dio</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">=</span><span class="n">DigitalIO</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Digital IO&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">dio</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
            </div>
<div class="viewcode-block" id="BaxterRobot.loadNavigator"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadNavigator">[docs]</a>    <span class="k">def</span> <span class="nf">loadNavigator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads the navigators</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the navigators</span>
<span class="sd">            :rtype: Navigator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">l</span><span class="o">=</span><span class="p">[</span><span class="s">&quot;right&quot;</span><span class="p">,</span><span class="s">&quot;left&quot;</span><span class="p">,</span><span class="s">&quot;torso_right&quot;</span><span class="p">,</span><span class="s">&quot;torso_left&quot;</span><span class="p">]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">navigator</span> <span class="o">==</span> <span class="p">{}:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadLeds</span><span class="p">()</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">navigator</span><span class="p">[</span><span class="nb">id</span><span class="p">]</span><span class="o">=</span><span class="n">Navigator</span><span class="p">(</span><span class="nb">id</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">led</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Navigators&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">navigator</span><span class="p">,</span><span class="n">l</span><span class="p">]</span>
            </div>
<div class="viewcode-block" id="BaxterRobot.yes"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.yes">[docs]</a>    <span class="k">def</span> <span class="nf">yes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The robots nods with the display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">command_nod</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="BaxterRobot.no"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.no">[docs]</a>    <span class="k">def</span> <span class="nf">no</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            The robot shakes its display</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">head</span><span class="o">.</span><span class="n">command_deny</span><span class="p">()</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadTextDisplay"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadTextDisplay">[docs]</a>    <span class="k">def</span> <span class="nf">loadTextDisplay</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">autostdout</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads the text display</span>
<span class="sd">            </span>
<span class="sd">            :param autostdout: Should the text display linked to the standard prints?</span>
<span class="sd">            :type autostdout: bool  </span>
<span class="sd">            :return: interface to the text display</span>
<span class="sd">            :rtype: BaxterTextDisplayer</span>
<span class="sd">        &quot;&quot;&quot;</span>     
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>   
            <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="o">=</span><span class="n">BaxterTextDisplayer</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datapath</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">display</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">autostdout</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">sys</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">=</span><span class="n">Tee</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">=</span><span class="n">Tee</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span><span class="o">.</span><span class="n">post</span><span class="o">.</span><span class="n">autoRefresh</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Text Display&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">textDisplay</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadRecorder"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadRecorder">[docs]</a>    <span class="k">def</span> <span class="nf">loadRecorder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Prepares the recorder</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the recorder</span>
<span class="sd">            :rtype: BaxterRecorder</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">br</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gripper</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadGrippers</span><span class="p">()</span>    
            <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loadArms</span><span class="p">()</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">br</span> <span class="o">=</span> <span class="n">BaxterRecorder</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Recorder&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">br</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.otherSide"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.otherSide">[docs]</a>    <span class="k">def</span> <span class="nf">otherSide</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">side</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Return the name of the other arm</span>
<span class="sd">            </span>
<span class="sd">            :param side: One name of an arm</span>
<span class="sd">            :type side: str</span>
<span class="sd">            :return: Name of the other arm</span>
<span class="sd">            :rtype: str    </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">side</span><span class="o">==</span><span class="s">&#39;left&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;right&#39;</span>
        <span class="k">elif</span> <span class="n">side</span><span class="o">==</span><span class="s">&#39;right&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;left&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">rospy</span><span class="o">.</span><span class="n">logwarn</span><span class="p">(</span><span class="s">&quot;unknown request: </span><span class="si">%s</span><span class="s">&quot;</span><span class="p">,</span><span class="n">side</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">False</span>
        </div>
<div class="viewcode-block" id="BaxterRobot.quat2list"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.quat2list">[docs]</a>    <span class="k">def</span> <span class="nf">quat2list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">quat</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; </span>
<span class="sd">            Converts a geometry.msgs.Quaternion to a list</span>
<span class="sd">            </span>
<span class="sd">            :param quat: Quaterion to convert</span>
<span class="sd">            :type quat: geometry.msgs.msgs.Quaternion</span>
<span class="sd">            :return: list containing a Quaternion</span>
<span class="sd">            :rtype: list</span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">quat</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">quat</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">quat</span><span class="o">.</span><span class="n">z</span><span class="p">,</span><span class="n">quat</span><span class="o">.</span><span class="n">w</span><span class="p">]</span>
           </div>
<div class="viewcode-block" id="BaxterRobot.pos2list"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.pos2list">[docs]</a>    <span class="k">def</span> <span class="nf">pos2list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">pos</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Converts a geometry.msgs.Point to a list</span>
<span class="sd">            </span>
<span class="sd">            :param pos: Point to convert</span>
<span class="sd">            :type pos: geometry.msgs.Point</span>
<span class="sd">            :return: list containing a Point</span>
<span class="sd">            :rtype: list  </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">pos</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">pos</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">pos</span><span class="o">.</span><span class="n">z</span><span class="p">]</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadBaxterScene"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadBaxterScene">[docs]</a>    <span class="k">def</span> <span class="nf">loadBaxterScene</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initializes the MoveIt scene</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the moveit scene</span>
<span class="sd">            :rtype: BaxterScene</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">moveit</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">scene</span> <span class="o">=</span> <span class="n">BaxterScene</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;Baxter Scene&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">scene</span>
        </div>
<div class="viewcode-block" id="BaxterRobot.addTasker"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.addTasker">[docs]</a>    <span class="k">def</span> <span class="nf">addTasker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">tasker</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Adds the GUI task interface of the workstation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tasker</span> <span class="o">=</span> <span class="n">tasker</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadHighLevelMovement"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadHighLevelMovement">[docs]</a>    <span class="k">def</span> <span class="nf">loadHighLevelMovement</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads the high level movement controller</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to high level motions</span>
<span class="sd">            :rtype: HighLevelMovement</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlm</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hlm</span> <span class="o">=</span> <span class="n">HighLevelMovement</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;High Level Movement&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hlm</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.loadURDFCreator"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.loadURDFCreator">[docs]</a>    <span class="k">def</span> <span class="nf">loadURDFCreator</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Loads the automatic URDF creator</span>
<span class="sd">            </span>
<span class="sd">            :return: interface to the automatic urdf creator</span>
<span class="sd">            :rtype: BaxterURDFCreator</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">uc</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="s">&quot;left&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="p">[</span><span class="s">&quot;right&quot;</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loadArms</span><span class="p">()</span>
            <span class="n">start</span> <span class="o">=</span> <span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">uc</span> <span class="o">=</span> <span class="n">BaxterURDFCreator</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">arm</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">datapath</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="p">(</span><span class="s">&quot;URDF Creator&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">uc</span>
    </div>
<div class="viewcode-block" id="BaxterRobot.timer"><a class="viewcode-back" href="../baxter_helper.html#baxter_helper.BaxterRobot.timer">[docs]</a>    <span class="k">def</span> <span class="nf">timer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">,</span><span class="n">start</span><span class="p">):</span>
        <span class="n">rospy</span><span class="o">.</span><span class="n">loginfo</span><span class="p">(</span><span class="s">&quot;Loading time for </span><span class="si">%s</span><span class="s"> was: </span><span class="si">%.4f</span><span class="s">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="nb">float</span><span class="p">(</span><span class="n">rospy</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)))</span>
</div></div>
<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>        
    <span class="n">rospy</span><span class="o">.</span><span class="n">init_node</span><span class="p">(</span><span class="s">&quot;baxter_helper&quot;</span><span class="p">)</span>
    <span class="n">baxter</span><span class="o">=</span><span class="n">BaxterRobot</span><span class="p">()</span>
    <span class="n">baxter</span><span class="o">.</span><span class="n">loadAll</span><span class="p">()</span>

    
        
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../index.html">baxter_tasker documentation</a> &raquo;</li>
          <li><a href="index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2014, HumaRobotics.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>